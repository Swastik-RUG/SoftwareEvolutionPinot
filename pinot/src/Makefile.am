bin_PROGRAMS = jikes

jikes_SOURCES = \
ast.cpp \
body.cpp \
bytecode.cpp \
case.cpp \
class.cpp \
code.cpp \
control.cpp \
decl.cpp \
definite.cpp \
depend.cpp \
diagnose.cpp \
double.cpp \
dump.cpp \
error.cpp \
expr.cpp \
incrmnt.cpp \
init.cpp \
javaact.cpp \
jikes.cpp \
jikesapi.cpp \
long.cpp \
lookup.cpp \
lpginput.cpp \
modifier.cpp \
op.cpp \
option.cpp \
parser.cpp \
platform.cpp \
scanner.cpp \
segment.cpp \
set.cpp \
stream.cpp \
symbol.cpp \
system.cpp \
tab.cpp \
unparse.cpp \
unzip.cpp \
zip.cpp

include_HEADERS = \
declarations/jikes/jikesapi.h

noinst_HEADERS = \
declarations/access.h \
ast.h \
ControlAnalysis.h \
bytecode.h \
declarations/case.h \
class.h \
declarations/code.h \
declarations/control.h \
depend.h \
diagnose.h \
declarations/double.h \
declarations/jikes/error.h \
javaact.h \
javadcl.h \
javadef.h \
javaprs.h \
javasym.h \
declarations/jikes/jikesapi.h \
declarations/long.h \
declarations/symbol/lookup.h \
declarations/lpginput.h \
declarations/op.h \
declarations/option.h \
parser.h \
declarations/platform.h \
declarations/scanner.h \
declarations/segment.h \
semantic.h \
set.h \
declarations/spell.h \
declarations/stream.h \
declarations/symbol/symbol.h \
tab.h \
declarations/table.h \
declarations/tuple.h \
unzip.h \
zip.h

# Include the java.g and gencode.java files in the .tar ball

EXTRA_DIST = java.g gencode.java

if MAINTAINER_MODE
# Special rules to remake autogenerated files
PARSER_FILES = \
javaact.cpp \
javaact.h \
javadcl.h \
javadef.h \
javaprs.h \
javasym.h

BUILT_SOURCES = $(PARSER_FILES) code.cpp declarations/code.h

javaact.stamp: $(srcdir)/java.g
	@rm -f javaact.tmp
	@$(TOUCH) javaact.tmp
	(cd $(srcdir); $(JIKESPG) java.g)
	rm -f $(srcdir)/java.l
	@mv -f javaact.tmp $@

$(PARSER_FILES): javaact.stamp
	@if test -f $@; then :; else \
	  rm -f javaact.stamp; \
	  $(MAKE) $(AM_MAKEFLAGS) javaact.stamp; \
	fi

# FIXME: hardcoded at the moment, makes bootstrap difficult...
JAVA = java
JAVAC = jikes -nowarn -source 1.4
code.stamp: $(srcdir)/gencode.java
	@rm -f code.tmp
	@$(TOUCH) code.tmp
	$(JAVAC) -d $(srcdir) $<
	(cd $(srcdir); $(JAVA) -classpath . gencode)
	@mv -f code.tmp $@

code.cpp code.h: code.stamp
	@if test -f $@; then :; else \
	  rm -f code.stamp; \
	  $(MAKE) $(AM_MAKEFLAGS) code.stamp; \
	fi

# end special maintainer mode section
endif


# This rule will build an efence malloc debugging enabled version of jikes.
# This should be used for testing purposes only! It is really slow!
efence:
	@rm -f jikes$(EXEEXT)
	$(CXXLINK) -o jikes$(EXEEXT) $(jikes_OBJECTS) -lstdc++ -lefence
